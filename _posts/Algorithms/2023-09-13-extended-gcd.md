---
layout: post
title: "확장 유클리드 알고리즘 쉽게 이해하기"
date: 2023-09-13 13:35:20 +0900
categories: Algorithms
use_math: true
---

* 이 글은 확장 유클리드 알고리즘이 무엇을 계산하는지는 아는 분들을 위한 글입니다. 확장 유클리드 알고리즘이 기반하는 베주 항등식 등의 수학적 지식이나 알고리즘의 활용법은 다루지 않습니다.
* 몇 달 전에 sait2000님께 들었던 설명을 기록하기 위한 포스트입니다.

확장 유클리드 알고리즘은 아래 문제를 $O(\log{ab})$ 안에 계산하는 알고리즘입니다.
- 두 양의 정수 $a$, $b$가 주어졌을 때 $as+bt = \gcd{(a, b)}$인 정수 $s$와 $t$를 구하시오.

이 글에서는 확장 유클리드 알고리즘의 원리를 좀 더 쉽게 이해하고 구현할 수 있는 방법을 소개합니다.


# 선형 결합
용어 하나를 정의하겠습니다.
- 두 수 $a$, $b$의 **선형 결합**은 두 수 각각에 어떤 정수를 곱하여 그 둘을 더하는 것을 의미합니다. 이때, $a$와 $b$에 각각 곱한 두 계수는 선형 결합 계수라고 부릅시다.

앞서 소개한 문제를 이 용어를 써서 다시 표현하면, $x$를 $a$와 $b$의 선형 결합으로 표현할 수 있는지, 가능하다면 그 계수는 얼마인지를 묻는 문제입니다.


# 유클리드 알고리즘
잠시 두 수의 최대공약수를 계산하는 알고리즘인 **유클리드 알고리즘**을 다시 봅시다. 유클리드 알고리즘의 코드는 아래와 같습니다.

```py
def gcd(a, b):
    while b != 0:
        a, b = b, a%b
    return a
```

위 코드는 $a$와 $b$를 $b$와 $a \bmod b$로 바꾸는 것을 반복하는 방식으로 동작합니다. 그러다가 $b=0$이 되면 $a = \gcd{(a, b)}$가 되므로 이를 반환합니다.


# 확장 유클리드 알고리즘
초기의 $a$와 $b$를 $a_0$, $b_0$라고 표기하겠습니다. 그리고, 이 섹션에서 *대괄호 표기*라고 부를 $[s, t]$라는 표기는 $a_0 s + b_0 t$를 의미합니다. 그렇게 놓고 나면, $as+bt = \gcd{(a, b)}$인 $s$와 $t$를 구하는 것은 $\gcd{(a, b)} = [s, t]$인 $s$, $t$를 구한다는 말로 다시 쓸 수 있습니다.

유클리드 알고리즘에서 $a$와 $b$를 이러한 대괄호 표기로 표기해봅시다. 초기에는 $a=a_0$, $b=b_0$이므로 $a = [1, 0]$, $b = [0, 1]$입니다.

이후에 루프가 돌고 있는 과정에서, 어떤 루프가 시작한 직후에 $a = [s_a, t_a]$이고 $b = [s_b, t_b]$였다고 합시다. 그러면 이 루프가 끝나고 난 뒤 $a$와 $b$ 각각의 대괄호 표기는 어떻게 될까요?

$a$를 $b$로 나눈 몫과 나머지를 $q$와 $r$이라 했을 때, $a$는 $b$가 되고 $b$는 $a-qb$가 됩니다. 따라서 "새로운" $a$와 $b$는 "기존의" $s_a$, $t_a$, $s_b$, $t_b$에 대해 $a = [s_b, t_b]$와 $b = [s_a - q s_b, t_a - q t_b]$를 만족합니다.

위 사실에 기반하여 $s_a$, $t_a$, $s_b$, $t_b$의 값을 유클리드 알고리즘의 코드 안에서 추적을 하면 아래와 같습니다.

```py
def egcd(a0, b0):
    a, b = a0, b0
    sa, ta, sb, tb = 1, 0, 0, 1
    while b != 0:
        q, r = divmod(a, b)
        sa, ta, sb, tb = sb, tb, sa-q*sb, ta-q*tb
        a, b = b, r
    return a, sa, ta
```

위 코드에서 루프가 종료되면, $a$와 $b$는 유클리드 알고리즘과 완전히 동일하므로 $a$는 $\gcd{(a, b)}$가 됩니다. 루프가 종료된 후의 $s_a$, $t_a$는 $a = \gcd{(a, b)} = [s_a, t_a]$를 만족할 것이므로, 이 둘은 문제에서 요구하는 $a$와 $b$의 $\gcd{(a, b)}$에 대한 선형 결합 계수입니다.

위 알고리즘을 **확장 유클리드 알고리즘**이라고 부릅니다. 코드의 구성이 유클리드 알고리즘과 동일하므로, 시간복잡도는 $O(\log{ab})$입니다.

# 구현
위 코드에선 설명을 쉽게 하기 위해 $a_0$와 $b_0$를 $a$와 $b$에서부터 분리했지만, 실제 구현에서 그렇게 할 필요는 없습니다.

그 외의 변경점은 없습니다.

```py
# Returns `g`, `s`, `t` such that `g == gcd(a, b)` and `a*s + b*t == g`.
def egcd(a, b):
    sa, ta, sb, tb = 1, 0, 0, 1
    while b != 0:
        q, r = divmod(a, b)
        sa, ta, sb, tb = sb, tb, sa-q*sb, ta-q*tb
        a, b = b, r
    return a, sa, ta
```
